{% if custom_height %}
  {% assign image_height = custom_height %}
{% else %}
  {% assign image_height = '100%' %}
{% endif %}

{% if caption %}
  <figure>
    <img
      class="article-template-image article-template-image--border"
      srcset="
        {% if section_image.width >= 350 %}{{ section_image | image_url: width: 350 }} 350w,{% endif %}
        {% if section_image.width >= 750 %}{{ section_image | image_url: width: 750 }} 750w,{% endif %}
        {% if section_image.width >= 1100 %}{{ section_image | image_url: width: 1100 }} 1100w,{% endif %}
        {% if section_image.width >= 1500 %}{{ section_image | image_url: width: 1500 }} 1500w,{% endif %}
        {% if section_image.width >= 2200 %}{{ section_image | image_url: width: 2200 }} 2200w,{% endif %}
        {% if section_image.width >= 3000 %}{{ section_image | image_url: width: 3000 }} 3000w,{% endif %}
        {{ section_image | image_url }} {{ section_image.width }}w
      "
      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 }}px, (min-width: 750px) calc(100vw - 10rem), 100vw"
      src="{{ section_image | image_url: width: 1100 }}"
      loading="eager"
      fetchpriority="high"
      width="{{ section_image.width }}"
      height="{{ image_height }}"
      alt="{{ section_image.alt | escape }}"
    >

    <figcaption class="article-template__section__caption" style="text-align: {{ text_alignment }}">
      {{ caption }}
    </figcaption>
  </figure>

{% else %}
  <img
    class="article-template-image article-template-image--border"
    srcset="
      {% if section_image.width >= 350 %}{{ section_image | image_url: width: 350 }} 350w,{% endif %}
      {% if section_image.width >= 750 %}{{ section_image | image_url: width: 750 }} 750w,{% endif %}
      {% if section_image.width >= 1100 %}{{ section_image | image_url: width: 1100 }} 1100w,{% endif %}
      {% if section_image.width >= 1500 %}{{ section_image | image_url: width: 1500 }} 1500w,{% endif %}
      {% if section_image.width >= 2200 %}{{ section_image | image_url: width: 2200 }} 2200w,{% endif %}
      {% if section_image.width >= 3000 %}{{ section_image | image_url: width: 3000 }} 3000w,{% endif %}
      {{ section_image | image_url }} {{ section_image.width }}w
    "
    sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 }}px, (min-width: 750px) calc(100vw - 10rem), 100vw"
    src="{{ section_image | image_url: width: 1100 }}"
    loading="eager"
    fetchpriority="high"
    width="{{ section_image.width }}"
    height="{{ image_height }}"
    alt="{{ section_image.alt | escape }}"
  >
{% endif %}
